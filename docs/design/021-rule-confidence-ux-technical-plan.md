# 021-技术方案

## 元数据

| 字段     | 值                       |
| -------- | ------------------------ |
| 文档编号 | 021-rule-confidence-ux    |
| 标题     | 规则库扩展 + 可信度增强 + 解释性强化 技术方案 |
| 版本     | 1.0                      |
| 状态     | 草稿                     |
| 创建日期 | 2026-02-13               |
| 更新日期 | 2026-02-13               |
| 作者     | 小周                     |
| 关联需求 | 021-rule-confidence-ux    |

## 概述

### 目的
扩展规则库与可信度逻辑，增强前端解释性展示。

### 范围
- 规则库条目扩展
- 可信度因子计算
- 前端风险链路展示

### 假设
- 规则引擎继续基于 JSON 配置

## 架构设计

### 高层架构
- OCR → 规则引擎 → 可信度计算 → LLM → 前端解释

### 组件图
- RuleEngine：增强规则集合
- Confidence: 计算多因素分数
- UI: 风险链路/证据展示

## 数据模型

### 实体
- RuleItem 扩展字段（人群标签/证据来源）
- ConfidenceInfo 新增 factors 列表

## API 设计

### 数据结构
- ConfidenceInfo: level + reasons + factors
- RuleHit: 增加 evidence/source 字段（如适用）

## 错误处理

- 规则加载失败降级为无规则模式

## 性能考虑

- 规则评估保持 O(n) 级

## 测试策略

- 单元测试：规则命中与可信度计算
- E2E：结果页展示风险链路

## 部署

- rules.json 更新与回滚策略

## 实施阶段

### 阶段 1：规则库扩展
- [ ] 补充过敏原与人群标签
- [ ] 补充高风险添加剂

### 阶段 2：可信度增强
- [ ] 可信度因子模型
- [ ] 低质量回退逻辑

### 阶段 3：前端解释性
- [ ] 风险链路与证据展示

## 风险与缓解

| 风险 | 影响 | 可能性 | 缓解措施 |
| ---- | ---- | ------ | -------- |
| 规则误判 | 中 | 中 | 增加黑名单/回退 |
| 解释过载 | 中 | 低 | 保持摘要与分层展示 |

## 待解决问题

| 问题 | 影响 | 负责人 | 状态 |
| ---- | ---- | ------ | ---- |
| 规则证据字段格式 | 中 | 小周 | 开放 |

## 参考资料

- 019/020 技术方案

---

## 变更记录

| 版本 | 日期 | 作者 | 描述 |
| ---- | ---- | ---- | ---- |
| 1.0  | 2026-02-13 | 小周 | 初始版本 |
