# 005-UI优化与处理流程改进需求文档

## 元数据

| 字段 | 值 |
|------|-----|
| 文档编号 | 005-ui-optimization |
| 标题 | UI优化与处理流程改进需求文档 |
| 版本 | 1.0 |
| 状态 | 草稿 |
| 创建日期 | 2026-01-17 |
| 更新日期 | 2026-01-17 |
| 作者 | Smart Ingredients Team |

## 概述

### 目的

优化用户界面和分析处理流程，提升用户体验和系统响应速度。当前存在以下问题：
1. 分析结果页面UI不够美观，信息展示不够清晰
2. 首页内容过于拥挤，在单屏内无法完整展示
3. OCR识别和LLM分析串行执行，导致整体处理时间过长，用户等待体验差

### 范围

**包含内容**：
- 分析结果页面UI重设计
- 首页布局优化和内容精简
- OCR识别与LLM分析的并行处理机制
- 分析进度的实时反馈

**不包含内容**：
- OCR和LLM算法本身的优化
- 新增功能特性
- 数据库架构调整

### 利益相关者

- **终端用户**：获得更好的视觉体验和更快的分析速度
- **开发团队**：需要实现UI重构和后端流程优化
- **产品团队**：提升产品竞争力和用户满意度

## 功能需求

### 需求 1：优化首页布局和内容

- **编号**: FR-005-001
- **优先级**: 高
- **描述**:
  - 精简首页内容，减少页面高度，确保核心内容在首屏可见
  - 优化品牌展示区域的尺寸和间距
  - 简化功能介绍和步骤说明
  - 将非核心内容（示例图片、详细步骤）设置为可折叠
  - 确保核心操作（开始分析按钮）在首屏可见且突出

- **验收标准**:
  - [ ] 首页核心内容（品牌、简短说明、开始按钮）在单屏内完整展示
  - [ ] 品牌图标和名称的尺寸适中，不占用过多空间（减少30-40%）
  - [ ] 功能介绍精简为一句话，使用更紧凑的布局
  - [ ] 步骤说明默认折叠，用户可选择展开查看
  - [ ] 示例图片区域默认折叠，用户可选择展开查看
  - [ ] 页面滚动流畅，没有明显的性能问题
  - [ ] 整体页面高度减少至少40%

### 需求 2：优化配料详情列表展示

- **编号**: FR-005-002
- **优先级**: 高
- **描述**:
  - 重新设计配料卡片的信息展示结构，提高空间利用率
  - 移除或隐藏无意义的"未知"字段
  - 优化信息层次，将重要信息（名称、风险）突出显示
  - 将次要信息（类别、功能）以更紧凑的方式展示
  - 仅在有实际内容时显示可选字段（备注）
  - 考虑使用标签（tags）形式展示类别和功能

- **验收标准**:
  - [ ] 配料名称使用较大字号，作为主要信息显示
  - [ ] 风险等级徽章紧邻配料名称，醒目展示
  - [ ] 类别和功能信息使用标签形式，水平排列，节省垂直空间
  - [ ] 当字段值为"未知"、空字符串或"暂无"时，该字段不显示
  - [ ] 备注字段仅在有实际内容时显示，使用较小字号
  - [ ] 卡片高度相比现在减少20-30%
  - [ ] 整体视觉层次清晰，信息密度适中，易于快速浏览
  - [ ] 多个配料卡片排列紧凑，间距合理

### 需求 3：优化分析结果页面整体UI

- **编号**: FR-005-003
- **优先级**: 高
- **描述**:
  - 重新设计分析结果页面的视觉风格和信息层次
  - 使用更现代化的卡片布局和颜色方案
  - 优化健康评分、摘要的展示方式
  - 增强视觉层次感，突出重点信息
  - 改进页面整体布局，减少不必要的空白

- **验收标准**:
  - [ ] 健康评分采用醒目的卡片展示，包含分数、等级和推荐建议
  - [ ] 摘要信息使用独立卡片，可展开/收起查看详情
  - [ ] 风险等级使用颜色标识（低风险：绿色，中风险：橙色，高风险：红色）
  - [ ] 页面整体布局紧凑，减少不必要的空白区域
  - [ ] 整体UI符合现代移动端设计规范
  - [ ] 在不同尺寸的手机屏幕上均能正常展示

### 需求 4：分离OCR识别和LLM分析流程，增加用户确认环节

- **编号**: FR-005-004
- **优先级**: 高
- **描述**:
  - 将当前一次性完成的处理流程分为两个独立阶段
  - 阶段1：上传图片 → OCR识别 → 展示识别文本给用户
  - 阶段2：用户确认/编辑文本 → 提交LLM分析 → 展示分析结果
  - 用户可以在OCR识别完成后查看和编辑识别文本
  - 用户确认文本正确后，再触发LLM分析
  - 提供文本编辑功能，允许用户修正OCR识别错误

- **验收标准**:
  - [ ] 上传图片后，仅执行OCR识别（不自动触发LLM分析）
  - [ ] OCR识别完成后，跳转到文本确认页面
  - [ ] 文本确认页面显示OCR识别的原始文本
  - [ ] 用户可以编辑识别文本（添加、删除、修改）
  - [ ] 提供"确认并分析"按钮，用户点击后才提交LLM分析
  - [ ] 提供"重新拍照"按钮，允许用户重新上传图片
  - [ ] LLM分析过程中显示"分析中"状态
  - [ ] LLM分析完成后跳转到结果页面
  - [ ] 整个流程清晰，用户可以掌控每个步骤

### 需求 5：增强分析进度反馈

- **编号**: FR-005-005
- **优先级**: 中
- **描述**:
  - 提供更详细的处理进度信息
  - 明确区分OCR识别和LLM分析两个阶段
  - 显示当前正在执行的步骤
  - 为每个阶段提供清晰的视觉反馈

- **验收标准**:
  - [ ] 分析页面显示当前处理阶段（OCR识别中 / 文本确认 / LLM分析中）
  - [ ] 每个阶段有对应的视觉反馈（进度指示器、动画等）
  - [ ] OCR识别过程显示"正在识别配料表..."
  - [ ] LLM分析过程显示"AI正在分析成分..."
  - [ ] 分析失败时显示具体的错误信息和重试选项
  - [ ] 整体进度展示清晰，用户能够了解当前状态

## 非功能需求

### 性能

- **OCR响应时间**：从上传完成到OCR结果返回 < 5秒（90%情况下）
- **整体分析时间**：OCR + LLM分析总时间 < 15秒（90%情况下）
- **页面加载时间**：首页和结果页加载时间 < 1秒
- **动画流畅度**：UI动画保持60fps

### 可用性

- **移动端适配**：支持主流手机屏幕尺寸（320px - 428px宽度）
- **响应式设计**：在不同屏幕尺寸下自动调整布局
- **无障碍性**：符合基本的无障碍访问标准
- **错误提示**：清晰的错误信息和操作指引

### 可靠性

- **降级处理**：如果LLM分析失败，仍能展示OCR识别结果
- **重试机制**：分析失败后提供重试选项
- **状态恢复**：页面刷新后能恢复之前的分析状态

### 可扩展性

- **组件化设计**：UI组件可复用和扩展
- **API解耦**：OCR和LLM服务独立调用
- **状态管理**：使用统一的状态管理机制

## 用户故事

### 故事 1：确认和修正OCR识别结果

- **作为** 用户
- **我想要** 在OCR识别完成后能够查看和编辑识别文本
- **以便** 确认识别是否准确，并修正可能的错误，提高最终分析的准确性

### 故事 2：清晰紧凑的配料列表

- **作为** 用户
- **我想要** 看到紧凑、清晰的配料信息，不显示无意义的"未知"字段
- **以便** 快速浏览所有配料，不被冗余信息干扰

### 故事 3：简洁的首页体验

- **作为** 用户
- **我想要** 在首页快速了解产品功能并开始分析
- **以便** 不需要滚动页面就能完成核心操作

### 故事 4：清晰的分析结果展示

- **作为** 用户
- **我想要** 看到结构清晰、重点突出的分析结果
- **以便** 快速了解食品的健康状况和潜在风险

### 故事 5：掌控分析流程

- **作为** 用户
- **我想要** 能够在每个关键步骤确认和控制流程
- **以便** 确保分析结果的准确性，而不是被动等待

## 用例

### 用例 1：上传图片、确认文本并查看分析结果（新流程）

- **参与者**: 用户
- **前置条件**: 用户已打开应用首页
- **主流程**:
  1. 用户点击"开始分析"按钮
  2. 系统打开文件选择器
  3. 用户选择一张配料表图片
  4. 系统显示图片预览
  5. 用户点击"确认上传"
  6. 系统上传图片并跳转到OCR识别页面
  7. 系统显示"正在识别配料表..."状态
  8. OCR识别完成，系统跳转到文本确认页面
  9. 用户查看OCR识别的文本
  10. 用户编辑文本（如有需要）
  11. 用户点击"确认并分析"按钮
  12. 系统显示"AI正在分析成分..."状态
  13. LLM分析完成，系统跳转到结果页面
  14. 用户查看健康评分、摘要和配料详情

- **后置条件**: 用户看到完整的分析结果
- **备选流程**:
  - 3a. 用户取消选择 → 返回首页
  - 7a. OCR识别失败 → 显示错误信息，提供重试选项
  - 10a. 用户发现识别文本完全错误 → 点击"重新拍照"返回首页
  - 12a. LLM分析失败 → 显示错误信息，提供重试选项

### 用例 2：在首页快速了解产品

- **参与者**: 新用户
- **前置条件**: 用户首次打开应用
- **主流程**:
  1. 用户看到品牌名称和标语（精简版）
  2. 用户看到简短的功能介绍（一句话）
  3. 用户看到"开始分析"按钮（首屏可见）
  4. 用户点击按钮开始使用

- **后置条件**: 用户理解产品功能并开始使用
- **备选流程**:
  - 3a. 用户想了解更多 → 展开步骤说明或示例图片

### 用例 3：快速浏览配料详情

- **参与者**: 用户
- **前置条件**: 用户已查看分析结果页面
- **主流程**:
  1. 用户滚动到配料详情区域
  2. 用户快速浏览配料卡片列表
  3. 用户识别高风险配料（红色标签）
  4. 用户查看配料的类别和功能（标签形式）
  5. 用户查看有备注的配料详情

- **后置条件**: 用户了解所有配料信息
- **备选流程**:
  - 2a. 配料过多 → 用户滚动查看更多配料

## 约束条件

### 技术约束

- 必须使用现有的Leptos框架和组件系统
- 必须保持与现有API的兼容性
- 必须支持主流移动浏览器（Safari, Chrome, Firefox）
- CSS动画需要考虑性能，避免过度使用

### 业务约束

- 不能改变核心业务流程（上传 → 识别 → 分析 → 结果）
- 必须保持数据的准确性和一致性
- 不能增加用户的操作步骤

### 时间约束

- 预计开发周期：2周
- UI设计：2-3天
- 前端开发：5-7天
- 后端开发：3-4天
- 测试和优化：2-3天

## 依赖关系

### 内部依赖

- **前端组件库**：需要更新和新增UI组件
- **状态管理**：需要扩展AppState以支持更细粒度的状态
- **路由系统**：可能需要调整页面跳转逻辑

### 外部依赖

- **OCR服务**：需要支持独立调用和结果返回
- **LLM服务**：需要支持异步调用和轮询机制
- **后端API**：需要新增或修改接口以支持分阶段处理

## 成功指标

- **用户满意度**：UI改进后，用户反馈评分提升20%
- **响应速度**：OCR结果展示时间从平均15秒降低到5秒
- **完成率**：用户完整完成分析流程的比例提升15%
- **跳出率**：首页跳出率降低10%
- **错误率**：分析失败率保持在5%以下

## 待解决问题

| 问题 | 影响 | 负责人 | 状态 |
|------|------|--------|------|
| OCR和LLM并行处理的API设计 | 高 | 后端开发 | 开放 |
| 如何在前端优雅地处理两阶段状态 | 中 | 前端开发 | 开放 |
| 是否需要缓存OCR结果以支持重新分析 | 低 | 架构师 | 开放 |
| UI设计稿的确认和评审 | 高 | UI设计师 | 开放 |

## 参考资料

- [现有UI实现](../../frontend/src/pages/result.rs)
- [现有首页实现](../../frontend/src/pages/capture.rs)
- [Leptos官方文档](https://leptos.dev/)
- [Material Design移动端规范](https://material.io/design)

---

## 变更记录

| 版本 | 日期 | 作者 | 描述 |
|------|------|------|------|
| 1.0 | 2026-01-17 | Smart Ingredients Team | 初始版本 |
