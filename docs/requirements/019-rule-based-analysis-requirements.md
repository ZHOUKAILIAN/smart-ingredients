# 019-规则兜底与可信度提升 需求文档

## 元数据

| 字段 | 值 |
|------|-----|
| 文档编号 | 019-rule-based-analysis |
| 标题 | 规则兜底与可信度提升 需求文档 |
| 版本 | 1.0 |
| 状态 | 草稿 |
| 创建日期 | 2026-02-13 |
| 更新日期 | 2026-02-13 |
| 作者 | 小周 |

## 概述

### 目的
通过“规则兜底 + LLM 解释”的方式提升配料分析结果的可信度与可解释性，降低误判与幻觉风险。

### 范围
- 增加配料规则库与规则评估流程
- 引入可信度提示与规则命中说明
- LLM 仅负责解释与建议，不直接决定核心风险结论

不包含：
- OCR 质量优化与图像预处理（另立需求）
- 完整成分知识图谱建设（后续迭代）

### 利益相关者
- 普通用户（获取更可信、可解释的分析结果）
- 运营/产品（降低负面反馈与误导风险）

## 功能需求

### 需求 1：规则库最小集合
- **编号**: FR-001
- **优先级**: 高
- **描述**: 建立最小规则库（20-50 个高频/高风险成分与过敏原），包括名称、类别、风险级别、适用人群提示。
- **验收标准**:
  - [ ] 至少包含 20 个高频/高风险成分与过敏原
  - [ ] 每个条目包含名称、类别、风险等级、说明

### 需求 2：规则兜底判定
- **编号**: FR-002
- **优先级**: 高
- **描述**: 分析流程先进行规则命中与风险判定，结果作为最终结论来源，LLM 输出仅用于解释说明。
- **验收标准**:
  - [ ] 规则命中信息可在结果中体现
  - [ ] LLM 输出不覆盖规则结论

### 需求 3：可信度提示
- **编号**: FR-003
- **优先级**: 高
- **描述**: 在结果页展示“可信度等级”（高/中/低），并说明原因（规则命中/文本确认/置信度）。
- **验收标准**:
  - [ ] 结果页显示可信度等级
  - [ ] 至少提供一条可信度解释

### 需求 4：风险依据展示
- **编号**: FR-004
- **优先级**: 中
- **描述**: 针对命中规则的成分，展示风险依据或简短说明（如“常见防腐剂，部分人群需注意”）。
- **验收标准**:
  - [ ] 命中成分有对应说明
  - [ ] 说明与规则库条目一致

### 需求 5：人群偏好联动
- **编号**: FR-005
- **优先级**: 中
- **描述**: 规则判定应考虑用户偏好（儿童/过敏等），对命中项增加提示或提升风险等级。
- **验收标准**:
  - [ ] 至少支持“过敏/儿童”偏好联动
  - [ ] 命中时提示文案有区分

## 非功能需求

### 性能
- 规则评估在 50ms 内完成（本地内存规则库）。

### 安全性
- 规则库数据可追溯，避免注入不可信来源。

### 可靠性
- 规则引擎异常时不影响整体流程，降级为纯 LLM 解释并提示“可信度低”。

### 可扩展性
- 规则库支持后续扩展（新增条目、分类与人群标签）。

## 用户故事

### 故事 1
- **作为** 普通用户
- **我想要** 看到分析结果的可信度与依据
- **以便** 判断结果是否可靠

### 故事 2
- **作为** 过敏人群用户
- **我想要** 对相关成分得到强提醒
- **以便** 避免误食风险

## 用例

### 用例 1：规则命中结果展示
- **参与者**: 用户
- **前置条件**: OCR 完成且用户确认文本
- **主流程**:
  1. 用户提交确认文本
  2. 系统运行规则判定
  3. 系统显示命中规则与风险说明
  4. 系统展示可信度等级与建议
- **后置条件**: 用户获得可解释结果
- **备选流程**: 规则引擎失败时展示“可信度低”并提示复核

## 约束条件

### 技术约束
- 规则库可配置为 JSON/数据库种子，需便于更新

### 业务约束
- 风险说明需避免过度医疗化措辞，保持建议性表述

### 法规约束
- 避免做医疗诊断结论，需提示仅供参考

## 依赖关系

### 内部依赖
- 现有 OCR 结果与确认流程
- 偏好设置与评分逻辑

### 外部依赖
- 无强依赖，可后续接入权威数据源

## 成功指标

- 结果页可信度展示覆盖率 100%
- 规则命中项可解释覆盖率 ≥ 90%

## 待解决问题

| 问题 | 影响 | 负责人 | 状态 |
|------|------|--------|------|
| 规则库最小集合的成分范围 | 中 | 待定 | 开放 |
| 风险等级分级标准 | 中 | 待定 | 开放 |

## 参考资料

- docs/standards/requirements-template.md

---

## 变更记录

| 版本 | 日期 | 作者 | 描述 |
|------|------|------|------|
| 1.0 | 2026-02-13 | 小周 | 初始版本 |
