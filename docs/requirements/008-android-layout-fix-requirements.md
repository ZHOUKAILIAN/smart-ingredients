# 008-安卓布局适配需求文档

## 元数据

| 字段 | 值 |
|------|-----|
| 文档编号 | 008-android-layout-fix |
| 标题 | 安卓设备布局适配需求文档 |
| 版本 | 1.0 |
| 状态 | 草稿 |
| 创建日期 | 2026-01-21 |
| 更新日期 | 2026-01-21 |
| 作者 | Claude Code |

## 概述

### 目的
修复安卓设备上应用显示异常的问题：
1. **左右空白问题**：应用内容左右两侧存在较大的空白边距，未能充分利用屏幕宽度
2. **顶部遮挡问题**：应用内容顶部与系统状态栏（显示电量、时间等）重叠或距离不当

### 范围
**包含内容**:
- 修复 `.app-shell` 容器的左右内边距
- 调整顶部安全区域，避免与系统状态栏重叠
- 优化移动端 viewport 配置
- 确保内容在安卓设备上正确显示且不遮挡系统 UI
- 保持在其他设备（iOS、桌面）上的正常显示

**不包含内容**:
- 其他布局或样式的调整
- 功能性改动
- 底部导航栏的适配（如需要可后续添加）

### 利益相关者
- 安卓设备用户
- 产品设计团队
- 前端开发团队

## 功能需求

### 需求 1：移除 app-shell 左右内边距
- **编号**: FR-001
- **优先级**: 高
- **描述**: 将 `.app-shell` 的 `padding` 从 `24px 16px` 修改为适当的值，移除左右 16px 的内边距，使内容可以充分利用屏幕宽度
- **验收标准**:
  - [ ] `.app-shell` 的左右 padding 为 0 或最小值
  - [ ] 内容区域在安卓设备上左右无明显空白
  - [ ] 在 iOS 和桌面设备上显示正常

### 需求 2：适配顶部安全区域
- **编号**: FR-002
- **优先级**: 高
- **描述**: 调整顶部 padding，确保内容不会被系统状态栏（电量、时间、信号等）遮挡，同时保持适当的视觉留白
- **验收标准**:
  - [ ] 内容顶部与系统状态栏有适当间距
  - [ ] 用户可以清晰看到系统状态栏信息
  - [ ] 应用内容不会与状态栏重叠
  - [ ] 使用 CSS `env(safe-area-inset-top)` 或固定值适配

### 需求 3：优化 viewport 配置
- **编号**: FR-003
- **优先级**: 高
- **描述**: 检查并优化 HTML 中的 viewport meta 标签配置，确保在安卓设备上正确缩放和显示，并正确处理安全区域
- **验收标准**:
  - [ ] viewport 配置正确设置 `width=device-width`
  - [ ] 设置 `initial-scale=1.0`
  - [ ] 添加 `viewport-fit=cover` 支持全面屏设备
  - [ ] 在多种安卓设备上测试显示正常

### 需求 4：确保页面内容自适应
- **编号**: FR-004
- **优先级**: 中
- **描述**: 确保 `.page` 容器和其他主要布局元素能够自适应不同屏幕宽度和高度
- **验收标准**:
  - [ ] `.page` 容器在移动设备上宽度合理利用屏幕
  - [ ] 内容不会超出屏幕宽度或被系统 UI 遮挡
  - [ ] 所有交互元素（按钮、输入框等）可正常点击
  - [ ] 考虑刘海屏、打孔屏等特殊屏幕形态

## 非功能需求

### 性能
- CSS 修改不应影响页面渲染性能
- 保持现有的页面加载速度

### 兼容性
- 支持主流安卓设备（Android 8.0+）
- 支持全面屏、刘海屏、打孔屏等不同屏幕形态
- 保持 iOS 设备的正常显示
- 保持桌面端的正常显示
- 兼容不同屏幕尺寸（4.7" - 6.7"）

### 可维护性
- CSS 修改应遵循现有的代码规范
- 保持样式的可读性和可维护性
- 使用标准的安全区域 API

## 用户故事

### 故事 1
- **作为** 安卓手机用户
- **我想要** 应用内容能够充分利用屏幕宽度
- **以便** 获得更好的视觉体验和更大的内容显示区域

### 故事 2
- **作为** 安卓手机用户
- **我想要** 应用内容不会被系统状态栏遮挡
- **以便** 我可以同时看到应用内容和系统信息（电量、时间等）

### 故事 3
- **作为** 移动端用户
- **我想要** 应用在不同设备上都能正确显示
- **以便** 无论使用什么设备都能获得一致的体验

## 用例

### 用例 1：安卓用户打开应用
- **参与者**: 安卓手机用户
- **前置条件**:
  - 用户已安装应用
  - 使用安卓设备打开应用
- **主流程**:
  1. 用户启动应用
  2. 应用加载首页
  3. 内容区域充满屏幕宽度（左右无明显空白）
  4. 内容顶部与状态栏保持适当距离
  5. 用户可以清晰看到系统状态栏（电量、时间等）
  6. 用户可以正常浏览和操作应用内容
- **后置条件**: 应用正常显示，用户体验良好
- **备选流程**:
  - 如果设备有刘海或打孔，内容应避开这些区域
  - 如果设备屏幕特别小/大，内容应适当调整但保持可用性

## 约束条件

### 技术约束
- 必须使用纯 CSS 解决方案
- 使用标准的安全区域 API（`env(safe-area-inset-*)`)
- 不能破坏现有的 Figma UI 设计
- 需要兼容 Tauri 的 WebView 环境

### 业务约束
- 修复必须快速完成，不影响开发进度
- 不能引入新的依赖或工具

### 设计约束
- 保持现有的视觉设计风格
- 不改变内容的布局结构
- 状态栏区域的留白应符合设计规范

## 依赖关系

### 内部依赖
- `frontend/src/styles/app.css` - 主样式文件
- `frontend/index.html` - HTML 入口文件
- Figma UI 设计系统（已实现）

### 外部依赖
- Tauri WebView 渲染引擎
- 安卓系统浏览器内核
- CSS 安全区域 API 支持

## 问题分析

### 当前问题
1. **左右空白问题**:
   - **根本原因**: `.app-shell` 设置了 `padding: 24px 16px`，导致左右各有 16px 的内边距
   - **影响**: 内容区域未能充分利用屏幕宽度

2. **顶部遮挡问题**:
   - **根本原因**: 顶部 padding 可能不足或未考虑系统状态栏高度
   - **影响**: 内容可能与状态栏重叠，或间距不合理

### 解决方案
1. **左右空白**: 将 `.app-shell` 的 padding 改为 `24px 0` 或使用安全区域值
2. **顶部适配**:
   - 使用 `padding-top: max(24px, env(safe-area-inset-top))` 或类似方案
   - 确保顶部有足够的留白避开状态栏
3. **viewport 配置**: 添加 `viewport-fit=cover` 支持全面屏
4. **测试**: 在真实安卓设备上验证效果

## 技术方案

### CSS 安全区域适配
```css
.app-shell {
  /* 使用安全区域 API 确保内容不被系统 UI 遮挡 */
  padding-top: max(24px, env(safe-area-inset-top));
  padding-right: env(safe-area-inset-right);
  padding-bottom: env(safe-area-inset-bottom);
  padding-left: env(safe-area-inset-left);
}
```

### Viewport 配置
```html
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
```

## 成功指标

- [ ] 在至少 3 种不同尺寸的安卓设备上测试通过
- [ ] 在全面屏/刘海屏设备上测试通过
- [ ] 内容区域左右利用率达到 95% 以上（排除安全区域）
- [ ] 内容顶部与状态栏有合理间距（不重叠，不过大）
- [ ] iOS 和桌面端显示不受影响
- [ ] 用户反馈问题已解决

## 待解决问题

| 问题 | 影响 | 负责人 | 状态 |
|------|------|--------|------|
| Tauri WebView 是否完全支持 safe-area-inset | 高 | 开发团队 | 开放 |
| 是否需要为不同页面设置不同的顶部间距 | 中 | 设计团队 | 开放 |
| 底部导航栏是否也需要适配 | 低 | 产品团队 | 开放 |

## 参考资料

- [MDN - Viewport meta tag](https://developer.mozilla.org/en-US/docs/Web/HTML/Viewport_meta_tag)
- [MDN - env() CSS function](https://developer.mozilla.org/en-US/docs/Web/CSS/env)
- [CSS Safe Area](https://webkit.org/blog/7929/designing-websites-for-iphone-x/)
- [Tauri WebView Documentation](https://tauri.app/v1/guides/building/webview/)
- 现有需求文档：
  - 001-mobile-ui-requirements.md
  - 007-figma-ui-redesign-requirements.md

---

## 变更记录

| 版本 | 日期 | 作者 | 描述 |
|------|------|------|------|
| 1.0 | 2026-01-21 | Claude Code | 初始版本，包含左右空白和顶部安全区域适配需求 |
