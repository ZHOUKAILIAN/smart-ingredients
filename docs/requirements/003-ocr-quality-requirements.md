# 003-OCR 质量提升需求文档

## 元数据

| 字段     | 值                   |
| -------- | -------------------- |
| 文档编号 | 003-001              |
| 标题     | OCR 质量提升需求文档 |
| 版本     | 1.0                  |
| 状态     | 草稿                 |
| 创建日期 | 2026-01-17           |
| 更新日期 | 2026-01-17           |
| 作者     | Claude               |

## 概述

### 目的

提升配料表图片的 OCR 识别质量，解决“配料表较长”“图片不清晰”导致的识别不完整问题，为 LLM 分析提供更可靠的文本输入。

### 范围

**包含**:

- OCR 前置图像预处理（提高清晰度、对比度、降噪等）
- 自动裁剪/分割长配料表区域
- 多轮识别与结果合并
- OCR 结果质量评分与兜底策略

**不包含**（留待后续）:

- 人工校对工作流
- 高精度商业 OCR 付费集成
- 复杂版式/表格结构化解析（如营养成分表结构化）

## 功能需求

### 需求 1：图像预处理

- **编号**: FR-OCR-001
- **优先级**: 高
- **描述**: 对上传图片执行预处理以提升 OCR 识别质量
- **验收标准**:
  - [ ] 自动灰度化、对比度增强、降噪、二值化
  - [ ] 自动旋转/纠偏（倾斜角度修正）
  - [ ] 支持放大处理（小字放大）

### 需求 2：长文本分割识别

- **编号**: FR-OCR-002
- **优先级**: 高
- **描述**: 对配料表区域进行自动裁剪或分割，提高长文本识别完整性
- **验收标准**:
  - [ ] 自动检测并裁剪文字区域
  - [ ] 对长图进行分段识别（多段文本合并）
  - [ ] 保持识别结果顺序正确

### 需求 3：多轮 OCR 与合并

- **编号**: FR-OCR-003
- **优先级**: 中
- **描述**: 使用多种参数策略进行 OCR，多轮结果合并
- **验收标准**:
  - [ ] 支持多配置 OCR（不同 psm/oem/语言）
  - [ ] 结果合并去重，保留置信度更高文本

### 需求 4：质量评分与兜底

- **编号**: FR-OCR-004
- **优先级**: 中
- **描述**: 对 OCR 输出进行质量评估，触发兜底策略
- **验收标准**:
  - [ ] 输出 OCR 质量评分（0-1 或 0-100）
  - [ ] 低质量时返回提示并支持重新上传
  - [ ] 允许前端传入手动文本作为兜底

## 约束条件

### 技术约束

- 继续使用本地开源 OCR（Tesseract 为优先）
- 与现有 Rust/Axum 后端兼容
- Docker 环境可运行

### 业务约束

- OCR 结果需要提示“建议人工核对”
- 不降低主流程可用性

## 依赖关系

### 内部依赖

- 后端上传与分析接口

### 外部依赖

- Tesseract OCR 引擎
- 可选：OpenCV 或图像处理库

## 成功指标

- [ ] 配料表文本识别完整率提升（相对当前版本）
- [ ] OCR 失败率下降（相对当前版本）
- [ ] 低质量图片能给出明确提示与兜底方案
