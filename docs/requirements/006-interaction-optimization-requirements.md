# 006-交互优化需求文档

## 元数据

| 字段 | 值 |
|------|-----|
| 文档编号 | 006-interaction-optimization |
| 标题 | 交互体验优化需求文档 |
| 版本 | 1.0 |
| 状态 | 草稿 |
| 创建日期 | 2026-01-19 |
| 更新日期 | 2026-01-19 |
| 作者 | Smart Ingredients Team |

## 概述

### 目的
优化应用的用户交互体验，解决当前版本中存在的交互问题,提升用户使用的流畅性和友好性。主要解决：加载状态缺失、页面信息过载、错误恢复能力不足、输入方式单一等问题。

### 范围
**包含**：
- 添加操作加载状态反馈
- 优化分析结果页面布局（分页展示）
- 增强错误处理和恢复能力
- 添加拍照功能（统一入口，系统相机自带相册选择）

**不包含**：
- 后端性能优化
- OCR 算法优化
- 数据分析逻辑改进

### 利益相关者
- 终端用户：获得更流畅、更友好的使用体验
- 产品团队：降低用户流失率，提升用户满意度
- 开发团队：建立完善的交互模式和错误处理机制

## 功能需求

### 需求 1：添加操作加载状态
- **编号**: FR-006-001
- **优先级**: 高
- **描述**: 在所有异步操作（OCR 识别、LLM 分析等）执行期间显示加载状态，让用户知道系统正在处理
- **验收标准**:
  - [ ] 点击"开始识别"按钮后显示 Loading 状态
  - [ ] 点击"开始分析"按钮后显示 Loading 状态
  - [ ] Loading 状态包含加载动画和提示文字
  - [ ] 操作完成后 Loading 状态自动消失
  - [ ] 操作失败时 Loading 状态消失并显示错误提示
  - [ ] 加载期间按钮应该禁用，防止重复点击

### 需求 2：优化分析结果页面布局
- **编号**: FR-006-002
- **优先级**: 高
- **描述**: 将分析结果页面拆分为概要页和详情页，避免信息过载，提升可读性
- **验收标准**:
  - [ ] 分析完成后首先显示概要页面
  - [ ] 概要页面包含：总体评分、主要风险提示、关键统计信息
  - [ ] 概要页面有"查看详细配料列表"按钮
  - [ ] 点击按钮后跳转到详细配料列表页面
  - [ ] 详情页面显示所有配料的完整信息
  - [ ] 详情页面有返回概要页的按钮
  - [ ] 页面切换流畅，有过渡动画

### 需求 3：增强错误恢复能力
- **编号**: FR-006-003
- **优先级**: 高
- **描述**: 在 OCR 识别失败或其他错误场景下，提供明确的错误提示和返回首页的能力
- **验收标准**:
  - [ ] OCR 识别失败时显示友好的错误提示
  - [ ] 错误提示页面有"返回首页"按钮
  - [ ] 点击"返回首页"按钮可以重新选择图片
  - [ ] LLM 分析失败时也能返回首页
  - [ ] 所有错误页面都提供恢复路径
  - [ ] 错误信息清晰，告知用户可能的原因和解决方法

### 需求 4：添加拍照功能
- **编号**: FR-006-004
- **优先级**: 中
- **描述**: 提供"拍照"按钮调用系统相机，用户可以直接拍照或从相机界面左下角进入相册选择图片
- **验收标准**:
  - [ ] 首页提供"拍照"按钮
  - [ ] 点击按钮后调用系统相机界面
  - [ ] 用户可以直接拍照
  - [ ] 用户可以从相机界面的相册入口选择已有图片
  - [ ] 选择完成后自动返回应用并预览图片
  - [ ] 功能在移动设备上可用
  - [ ] 桌面端调用文件选择器（优雅降级）
  - [ ] 选择的图片质量满足 OCR 识别要求

## 非功能需求

### 性能
- Loading 动画应流畅，不卡顿（60fps）
- 页面切换动画时长控制在 300ms 以内
- 图片预览加载时间 < 500ms

### 用户体验
- 所有交互都有即时反馈
- 错误提示语言友好、易懂
- 操作流程符合用户直觉
- 移动端适配良好，按钮大小适合触摸操作
- 图片获取方式符合用户习惯（利用系统相机的相册功能）

### 可访问性
- Loading 状态有 ARIA 标签
- 错误提示可被屏幕阅读器识别
- 按钮有清晰的文字标签

### 兼容性
- 图片选择功能在 iOS、Android、Web 平台正常工作
- 桌面端（macOS、Windows）优雅降级为文件选择器

## 用户故事

### 故事 1：加载状态反馈
- **作为** 应用用户
- **我想要** 在点击按钮后看到加载状态
- **以便** 知道系统正在处理我的请求，不会误以为应用卡死

### 故事 2：分页浏览分析结果
- **作为** 应用用户
- **我想要** 先看到配料表的概要分析
- **以便** 快速了解整体情况，需要时再查看详细列表

### 故事 3：错误恢复
- **作为** 应用用户
- **我想要** 在识别失败时能够返回首页
- **以便** 重新选择更清晰的图片进行识别

### 故事 4：便捷拍照
- **作为** 移动端用户
- **我想要** 点击"拍照"按钮就能拍照或选择图片
- **以便** 使用系统熟悉的相机界面，自由选择拍照或从相册选择

## 用例

### 用例 1：OCR 识别加载状态
- **参与者**: 用户
- **前置条件**: 用户已选择图片并进入预览页面
- **主流程**:
  1. 用户点击"开始识别"按钮
  2. 按钮变为禁用状态，显示 Loading 动画
  3. 显示提示文字："正在识别配料表..."
  4. OCR 服务处理图片
  5. 识别成功后 Loading 消失，跳转到识别结果页
- **后置条件**: 用户看到识别结果
- **备选流程**:
  - 4a. OCR 识别失败
    - 显示错误提示："识别失败，请确保图片清晰可读"
    - 提供"返回首页"和"重试"按钮

### 用例 2：查看详细配料列表
- **参与者**: 用户
- **前置条件**: LLM 分析完成，显示概要页面
- **主流程**:
  1. 用户在概要页面查看总体评分和关键信息
  2. 用户点击"查看详细配料列表"按钮
  3. 页面切换到详情页，带过渡动画
  4. 显示所有配料的完整列表
  5. 用户可以滚动查看所有配料
  6. 用户点击"返回概要"按钮
  7. 返回概要页面
- **后置条件**: 用户可以在概要和详情之间自由切换
- **备选流程**: 无

### 用例 3：拍照或选择图片
- **参与者**: 移动端用户
- **前置条件**: 用户在首页
- **主流程**:
  1. 用户点击"拍照"按钮
  2. 系统调用相机权限（首次需要授权）
  3. 打开系统相机界面
  4. 用户选择：
     - 4a. 直接拍照 → 确认照片
     - 4b. 点击左下角相册图标 → 选择已有照片
  5. 返回应用，显示图片预览
  6. 用户点击"开始识别"继续后续流程
- **后置条件**: 用户获得配料表图片并可以进行识别
- **备选流程**:
  - 2a. 用户拒绝相机权限
    - 显示提示："需要相机权限才能拍照，请在设置中开启"
    - 提供"前往设置"按钮
  - 4c. 用户取消操作
    - 返回首页，不做任何操作

### 用例 4：桌面端选择图片
- **参与者**: 桌面端用户
- **前置条件**: 用户在首页
- **主流程**:
  1. 用户点击"拍照"按钮
  2. 打开系统文件选择器
  3. 用户浏览文件系统，选择图片文件
  4. 返回应用，显示图片预览
  5. 用户点击"开始识别"继续后续流程
- **后置条件**: 用户获得配料表图片并可以进行识别
- **备选流程**:
  - 3a. 用户取消选择
    - 返回首页，不做任何操作

## 约束条件

### 技术约束
- 使用 Leptos 框架的响应式状态管理
- 使用 Tauri 的 API 调用系统相机/文件选择器
- 动画使用 CSS transitions 或 Leptos 的动画库
- 需要适配不同屏幕尺寸（响应式设计）

### 业务约束
- 不改变现有的 OCR 和 LLM 分析流程
- 保持向后兼容，不破坏现有功能
- 优化后的交互流程不应增加用户操作步骤

### 平台约束
- 移动端依赖设备相机硬件和权限
- Web 版本需要浏览器支持 `getUserMedia` API 或文件选择
- 桌面端使用文件选择器作为降级方案

## 依赖关系

### 内部依赖
- 依赖现有的 OCR 识别服务接口
- 依赖现有的 LLM 分析服务接口
- 依赖现有的图片上传和预览功能

### 外部依赖
- Tauri 的文件系统和相机 API
- 系统相机权限（移动端）
- 浏览器的 `getUserMedia` API（Web 版本）

## 成功指标

- 用户在操作过程中不再感到困惑（通过用户反馈）
- 错误恢复率提升（用户遇到错误后能够继续使用）
- 用户完成完整流程的比例提升
- 用户满意度评分提升
- 图片获取成功率 > 95%

## 待解决问题

| 问题 | 影响 | 负责人 | 状态 |
|------|------|--------|------|
| Web 版本相机调用的实现方式 | 中 | 前端开发 | 开放 |
| Loading 动画的具体设计风格 | 低 | UI 设计 | 开放 |
| 概要页面的具体内容和布局 | 高 | 产品 + 前端 | 开放 |
| 不同平台相机 API 的兼容性测试 | 中 | 前端开发 | 开放 |

## 参考资料

- [Tauri Camera Plugin](https://tauri.app/v1/guides/features/camera/)
- [MDN: MediaDevices.getUserMedia()](https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia)
- [Leptos Loading States](https://leptos.dev/)
- 现有需求文档：
  - `001-mobile-ui-requirements.md`
  - `005-ui-optimization-requirements.md`

---

## 变更记录

| 版本 | 日期 | 作者 | 描述 |
|------|------|------|------|
| 1.0 | 2026-01-19 | Smart Ingredients Team | 初始版本 |
