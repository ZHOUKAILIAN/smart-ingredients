# 013-底部导航与首次引导需求文档

## 元数据

| 字段 | 值 |
|------|-----|
| 文档编号 | 013-tab-navigation-and-onboarding |
| 标题 | 底部 Tab 导航与首次引导需求文档 |
| 版本 | 1.0 |
| 状态 | 草稿 |
| 创建日期 | 2026-01-26 |
| 更新日期 | 2026-01-26 |
| 作者 | Claude Code |

## 概述

### 目的

优化 Smart Ingredients 应用的导航体验和新用户引导流程，解决以下问题：
1. 登录页缺少产品功能介绍，用户不了解登录价值
2. 首页内容过多，老用户每次打开都要看冗余介绍
3. 缺少底部导航，页面切换不便
4. 新用户缺少首次使用引导

### 范围

**包含**：
- 底部 Tab 导航（3 个 Tab）
- 首次启动引导页（Onboarding）
- 简化版首页（移除冗余介绍）
- 登录页功能介绍优化
- 未登录状态的引导文案

**不包含**：
- Tab 图标的详细设计（由 UI 设计师提供）
- 引导页的动画效果（后期优化）
- 深色模式适配（后期优化）
- 手势导航（后期优化）

### 利益相关者

- **新用户**：需要快速了解产品价值和使用方法
- **老用户**：需要快速访问核心功能，无冗余干扰
- **未登录用户**：需要了解登录后的价值
- **产品团队**：需要提高用户留存率和登录转化率
- **开发团队**：需要清晰的技术规范

## 功能需求

### 需求 1：底部 Tab 导航

- **编号**: FR-001
- **优先级**: 高
- **描述**: 添加固定底部导航栏，包含 3 个 Tab（首页、历史、我的），支持快速切换页面
- **验收标准**:
  - [ ] 底部导航栏固定在页面底部，始终可见
  - [ ] 包含 3 个 Tab：首页（🏠）、历史（📋）、我的（👤）
  - [ ] 当前激活的 Tab 高亮显示
  - [ ] 点击 Tab 切换到对应页面
  - [ ] Tab 切换时保持页面状态（不重新加载）
  - [ ] 在分析流程页面（OCR、确认、分析中、结果）隐藏底部导航
  - [ ] 支持移动端触摸操作（最小触摸区域 44x44px）
  - [ ] Tab 图标和文字清晰可辨

### 需求 2：首次启动引导页

- **编号**: FR-002
- **优先级**: 高
- **描述**: 新用户首次打开应用时显示引导页，介绍产品核心价值和使用步骤
- **验收标准**:
  - [ ] 首次启动时自动显示引导页
  - [ ] 使用 LocalStorage 标记 `hasSeenOnboarding`，避免重复显示
  - [ ] 引导页包含：品牌标识、产品介绍、使用步骤（3 步）
  - [ ] 提供"开始使用"按钮，点击后进入首页 Tab
  - [ ] 提供"跳过"链接，允许用户快速跳过
  - [ ] 点击"开始使用"或"跳过"后，设置 `hasSeenOnboarding = true`
  - [ ] 引导页样式与应用整体风格一致

### 需求 3：简化版首页

- **编号**: FR-003
- **优先级**: 高
- **描述**: 简化首页内容，移除冗余介绍，突出核心功能（拍照分析）
- **验收标准**:
  - [ ] 移除品牌标识（Brand Mark）- 移到引导页
  - [ ] 移除使用步骤说明 - 移到引导页
  - [ ] 移除"查看示例"区域 - 可选移到"我的"Tab
  - [ ] 保留大尺寸"开始分析"按钮作为主要入口
  - [ ] 登录后显示"最近分析"区域（最多 3 条）
  - [ ] 未登录时显示小提示："💡 登录保存历史记录"
  - [ ] 点击"最近分析"中的记录可直接查看详情
  - [ ] 页面加载速度 < 500ms

### 需求 4：历史 Tab（独立）

- **编号**: FR-004
- **优先级**: 高
- **描述**: 将历史记录功能从"我的"页面独立出来，作为单独的 Tab
- **验收标准**:
  - [ ] 未登录状态：显示登录引导，说明登录后的价值
  - [ ] 登录后状态：显示分析历史列表
  - [ ] 历史列表按时间倒序排列
  - [ ] 每条记录显示：健康评分、分析时间、缩略图（可选）
  - [ ] 支持点击记录查看详情
  - [ ] 支持删除单条记录
  - [ ] 支持分页加载（每页 20 条）
  - [ ] 空状态显示："暂无历史记录"
  - [ ] 加载状态显示 Loading 动画

### 需求 5：我的 Tab（优化）

- **编号**: FR-005
- **优先级**: 中
- **描述**: 优化"我的"页面，聚焦个人信息和设置，移除历史记录功能
- **验收标准**:
  - [ ] 未登录状态：显示"登录/注册"按钮 + 登录价值说明
  - [ ] 登录后状态：显示用户信息（手机号脱敏、注册时间、分析次数）
  - [ ] 提供功能入口：偏好设置、账号安全、帮助与反馈
  - [ ] 提供"查看使用教程"入口（可重新查看引导页）
  - [ ] 提供"退出登录"按钮
  - [ ] 提供"注销账号"按钮（需二次确认）
  - [ ] 未登录状态提供"设置"、"帮助与反馈"等通用功能入口

### 需求 6：登录页功能介绍

- **编号**: FR-006
- **优先级**: 中
- **描述**: 在登录页添加功能介绍，让用户了解登录后的价值
- **验收标准**:
  - [ ] 登录页顶部保留品牌标识
  - [ ] 添加副标题："登录以同步您的数据"
  - [ ] 添加功能列表：
    - ✓ 保存分析历史，随时查看
    - ✓ 跨设备同步偏好设置
    - ✓ 查看分析次数统计
  - [ ] 功能列表使用对勾图标，视觉清晰
  - [ ] 保留原有登录表单（手机号 + 验证码）
  - [ ] 添加"跳过，稍后登录"链接，跳转到首页 Tab

### 需求 7：未登录状态引导优化

- **编号**: FR-007
- **优先级**: 中
- **描述**: 优化未登录用户在各页面的引导文案和交互
- **验收标准**:
  - [ ] 历史 Tab 未登录引导：
    - 标题："📋 分析历史"
    - 说明："登录后可查看历史记录"
    - 价值列表：保存所有分析记录、随时查看历史结果、跨设备同步数据
    - "去登录"按钮
  - [ ] 我的 Tab 未登录引导：
    - 标题："👤 个人中心"
    - "登录/注册"按钮
    - 价值列表：查看分析统计、管理偏好设置、同步跨设备数据
  - [ ] 首页未登录提示：
    - 小图标 + 文字："💡 登录保存历史记录"
    - 点击后跳转登录页
  - [ ] 所有引导文案简洁、友好、突出价值

### 需求 8：Tab 状态保持

- **编号**: FR-008
- **优先级**: 中
- **描述**: 切换 Tab 时保持页面状态，避免重新加载
- **验收标准**:
  - [ ] 首页 Tab：保持滚动位置、图片选择状态
  - [ ] 历史 Tab：保持滚动位置、当前页码
  - [ ] 我的 Tab：保持滚动位置
  - [ ] 从分析流程返回时，恢复到之前的 Tab
  - [ ] 应用重启后，恢复到上次访问的 Tab（可选）

### 需求 9：引导页重新查看

- **编号**: FR-009
- **优先级**: 低
- **描述**: 用户可以在"我的"Tab 中重新查看引导页
- **验收标准**:
  - [ ] "我的"Tab 提供"查看使用教程"入口
  - [ ] 点击后显示引导页
  - [ ] 引导页提供"关闭"按钮
  - [ ] 关闭后返回"我的"Tab

## 非功能需求

### 性能

- Tab 切换响应时间 < 100ms
- 首页加载时间 < 500ms
- 引导页加载时间 < 300ms
- Tab 切换时无明显卡顿或闪烁

### 可用性

- 底部导航栏高度适配不同屏幕尺寸
- Tab 图标和文字清晰可辨（最小字号 12px）
- 触摸区域符合移动端标准（最小 44x44px）
- 支持单手操作（拇指可达区域）

### 可访问性

- Tab 图标提供 aria-label
- 当前激活 Tab 使用 aria-current="page"
- 支持键盘导航（Web 版）
- 颜色对比度符合 WCAG AA 标准

### 兼容性

- 支持 iOS 13+ 和 Android 8+
- 支持不同屏幕尺寸（4.7" - 6.7"）
- 适配刘海屏和全面屏（Safe Area）

## 用户故事

### 故事 1：新用户首次使用

- **作为** 新用户
- **我想要** 快速了解产品功能和使用方法
- **以便** 决定是否继续使用

### 故事 2：老用户快速访问

- **作为** 老用户
- **我想要** 打开应用后直接进入拍照页面
- **以便** 快速开始分析，无冗余干扰

### 故事 3：查看历史记录

- **作为** 登录用户
- **我想要** 通过底部导航快速切换到历史页面
- **以便** 查看之前的分析记录

### 故事 4：了解登录价值

- **作为** 未登录用户
- **我想要** 了解登录后能获得什么功能
- **以便** 决定是否登录

### 故事 5：管理个人信息

- **作为** 登录用户
- **我想要** 通过底部导航快速进入个人中心
- **以便** 管理我的账号和偏好设置

## 用例

### 用例 1：新用户首次启动

- **参与者**: 新用户
- **前置条件**: 应用首次安装，未设置 `hasSeenOnboarding`
- **主流程**:
  1. 用户打开应用
  2. 系统检测到 `hasSeenOnboarding` 为空
  3. 显示引导页（品牌介绍 + 使用步骤）
  4. 用户点击"开始使用"
  5. 系统设置 `hasSeenOnboarding = true`
  6. 跳转到首页 Tab（简化版）
  7. 显示底部导航栏
- **后置条件**: 用户进入首页，可以开始使用
- **备选流程**:
  - 4a. 用户点击"跳过" → 同样设置标记并跳转首页

### 用例 2：老用户再次启动

- **参与者**: 老用户
- **前置条件**: `hasSeenOnboarding = true`
- **主流程**:
  1. 用户打开应用
  2. 系统检测到 `hasSeenOnboarding = true`
  3. 直接显示首页 Tab（简化版）
  4. 显示底部导航栏
  5. 用户点击"开始分析"按钮
  6. 进入拍照页面
- **后置条件**: 用户快速进入核心功能
- **备选流程**:
  - 5a. 用户点击"历史"Tab → 跳转到历史页面
  - 5b. 用户点击"我的"Tab → 跳转到个人中心

### 用例 3：未登录用户访问历史

- **参与者**: 未登录用户
- **前置条件**: 用户未登录
- **主流程**:
  1. 用户点击底部导航"历史"Tab
  2. 系统检测到用户未登录
  3. 显示登录引导页面
  4. 显示登录价值说明（保存记录、跨设备同步等）
  5. 用户点击"去登录"按钮
  6. 跳转到登录页
- **后置条件**: 用户进入登录流程
- **备选流程**:
  - 5a. 用户点击其他 Tab → 切换到对应页面

### 用例 4：登录用户查看历史

- **参与者**: 登录用户
- **前置条件**: 用户已登录
- **主流程**:
  1. 用户点击底部导航"历史"Tab
  2. 系统加载用户的分析历史
  3. 显示历史记录列表（按时间倒序）
  4. 用户点击某条记录
  5. 跳转到结果详情页
  6. 底部导航隐藏（详情页全屏显示）
  7. 用户点击返回
  8. 返回历史 Tab，底部导航重新显示
- **后置条件**: 用户查看了历史记录
- **备选流程**:
  - 2a. 历史记录为空 → 显示空状态提示

### 用例 5：Tab 切换状态保持

- **参与者**: 用户
- **前置条件**: 用户在历史 Tab 浏览到第 3 页
- **主流程**:
  1. 用户在历史 Tab 滚动到第 3 页
  2. 用户点击"首页"Tab
  3. 切换到首页
  4. 用户点击"历史"Tab
  5. 系统恢复历史页面状态（第 3 页，滚动位置）
- **后置条件**: 历史页面状态保持
- **备选流程**: 无

### 用例 6：重新查看引导页

- **参与者**: 老用户
- **前置条件**: 用户已使用过应用
- **主流程**:
  1. 用户点击底部导航"我的"Tab
  2. 滚动到"查看使用教程"
  3. 点击"查看使用教程"
  4. 显示引导页（与首次启动相同）
  5. 用户点击"关闭"
  6. 返回"我的"Tab
- **后置条件**: 用户重新了解了使用方法
- **备选流程**: 无

## 页面结构设计

### 引导页（OnboardingPage）

```
┌─────────────────────────────────┐
│                                 │
│       [Brand Mark: SI + AI]     │
│                                 │
│      Smart Ingredients          │
│      AI智能配料表分析           │
│                                 │
│   拍摄识别配料表，AI分析健康    │
│   风险，让您吃得更安心          │
│                                 │
├─────────────────────────────────┤
│                                 │
│   【使用步骤】                  │
│                                 │
│   [1] 🎥 拍摄配料表             │
│   对准食品包装上的配料表拍照     │
│                                 │
│   [2] ✅ 确认识别文本           │
│   AI自动识别配料信息            │
│                                 │
│   [3] 📊 查看健康报告           │
│   获取详细的成分分析和建议       │
│                                 │
├─────────────────────────────────┤
│                                 │
│      [开始使用] 按钮            │
│                                 │
│      [跳过] 链接                │
│                                 │
└─────────────────────────────────┘
```

### 简化版首页（CapturePage）

```
┌─────────────────────────────────┐
│                                 │
│                                 │
│       [大拍照图标/按钮]         │
│       开始分析配料表            │
│                                 │
│                                 │
│   ┌─────────────────────────┐   │
│   │ 💡 登录保存历史记录     │   │  ← 未登录提示
│   └─────────────────────────┘   │
│                                 │
│   【最近分析】(登录后显示)      │
│   ┌─────────────────────────┐   │
│   │ 🍪 某品牌饼干           │   │
│   │ 评分: 85 | 今天         │   │
│   └─────────────────────────┘   │
│   ┌─────────────────────────┐   │
│   │ 🥤 某品牌饮料           │   │
│   │ 评分: 72 | 昨天         │   │
│   └─────────────────────────┘   │
│                                 │
├─────────────────────────────────┤
│  [🏠 首页]  [📋 历史]  [👤 我的] │  ← 底部导航
└─────────────────────────────────┘
```

### 历史 Tab - 未登录状态

```
┌─────────────────────────────────┐
│   📋 分析历史                   │
│                                 │
│   登录后可查看历史记录          │
│                                 │
│   登录后可以：                  │
│   ✓ 保存所有分析记录            │
│   ✓ 随时查看历史结果            │
│   ✓ 跨设备同步数据              │
│                                 │
│      [去登录] 按钮              │
│                                 │
├─────────────────────────────────┤
│  [🏠 首页]  [📋 历史]  [👤 我的] │
└─────────────────────────────────┘
```

### 历史 Tab - 登录后状态

```
┌─────────────────────────────────┐
│   📋 分析历史                   │
│                                 │
│   ┌─────────────────────────┐   │
│   │ 🍪 某品牌饼干           │   │
│   │ 评分: 85 | 今天         │   │
│   └─────────────────────────┘   │
│   ┌─────────────────────────┐   │
│   │ 🥤 某品牌饮料           │   │
│   │ 评分: 72 | 昨天         │   │
│   └─────────────────────────┘   │
│   ┌─────────────────────────┐   │
│   │ 🍫 某品牌巧克力         │   │
│   │ 评分: 90 | 3天前        │   │
│   └─────────────────────────┘   │
│                                 │
│      [加载更多]                 │
│                                 │
├─────────────────────────────────┤
│  [🏠 首页]  [📋 历史]  [👤 我的] │
└─────────────────────────────────┘
```

### 我的 Tab - 未登录状态

```
┌─────────────────────────────────┐
│   👤 个人中心                   │
│                                 │
│      [登录/注册] 按钮           │
│                                 │
│   登录后可以：                  │
│   ✓ 查看分析统计                │
│   ✓ 管理偏好设置                │
│   ✓ 同步跨设备数据              │
│                                 │
│   ──────────────────────        │
│                                 │
│   ⚙️ 设置                       │
│   ❓ 帮助与反馈                 │
│   📖 查看使用教程               │
│                                 │
├─────────────────────────────────┤
│  [🏠 首页]  [📋 历史]  [👤 我的] │
└─────────────────────────────────┘
```

### 我的 Tab - 登录后状态

```
┌─────────────────────────────────┐
│   👤 个人中心                   │
│                                 │
│   手机号: 138****1234           │
│   注册时间: 2026-01-20          │
│   分析次数: 23 次               │
│                                 │
│   ──────────────────────        │
│                                 │
│   ⚙️ 偏好设置                   │
│   📊 数据统计                   │
│   🔐 账号安全                   │
│   📖 查看使用教程               │
│   ❓ 帮助与反馈                 │
│                                 │
│   ──────────────────────        │
│                                 │
│   🚪 退出登录                   │
│   ⚠️ 注销账号                   │
│                                 │
├─────────────────────────────────┤
│  [🏠 首页]  [📋 历史]  [👤 我的] │
└─────────────────────────────────┘
```

### 登录页 - 优化后

```
┌─────────────────────────────────┐
│       [Brand Mark: SI + AI]     │
│      Smart Ingredients          │
│      登录以同步您的数据         │
│                                 │
│   登录后可以：                  │
│   ✓ 保存分析历史，随时查看      │
│   ✓ 跨设备同步偏好设置          │
│   ✓ 查看分析次数统计            │
│                                 │
│   ──────────────────────        │
│                                 │
│   [手机号输入框]                │
│   [验证码输入框] [获取验证码]   │
│                                 │
│      [登录] 按钮                │
│                                 │
│   [跳过，稍后登录] 链接         │
│                                 │
└─────────────────────────────────┘
```

## 约束条件

### 技术约束

- 必须使用 Leptos 框架实现底部导航组件
- 必须使用 LocalStorage 存储 `hasSeenOnboarding` 标记
- Tab 切换使用 Leptos Router 的路由机制
- 底部导航在分析流程页面（/ocr, /confirm, /analyzing, /result）自动隐藏

### 业务约束

- 引导页只在首次启动时显示一次
- 底部导航必须在所有主页面显示（首页、历史、我的）
- 未登录用户必须能使用核心功能（拍照分析）
- 登录引导必须突出价值，不能强制登录

### 设计约束

- 底部导航高度：56px（移动端标准）
- Tab 图标尺寸：24x24px
- Tab 文字大小：12px
- 最小触摸区域：44x44px
- 颜色方案遵循现有设计系统

## 依赖关系

### 内部依赖

- 依赖现有的路由系统（Leptos Router）
- 依赖现有的 AppState（auth_user 状态）
- 依赖现有的页面组件（CapturePage, HistoryPage, ProfilePage）
- 依赖现有的登录系统（LoginPage）

### 外部依赖

- LocalStorage API（存储引导页标记）
- Leptos Router（Tab 切换）
- CSS 动画（Tab 切换过渡效果，可选）

## 成功指标

- 新用户完成引导页查看率 > 80%
- 老用户首页加载速度提升 > 50%（移除冗余内容后）
- Tab 切换响应时间 < 100ms
- 登录页转化率提升 > 20%（添加功能介绍后）
- 历史 Tab 访问率 > 40%（登录用户中）
- 用户 7 日留存率提升 > 15%

## 待解决问题

| 问题 | 影响 | 负责人 | 状态 |
|------|------|--------|------|
| Tab 图标设计风格（线性 vs 填充） | 低 | UI 设计师 | 开放 |
| 是否需要 Tab 切换动画效果 | 低 | 产品 | 开放 |
| 引导页是否支持滑动查看多页 | 中 | 产品 | 开放 |
| 是否需要在设置中提供"重置引导"选项 | 低 | 产品 | 开放 |
| 底部导航是否需要支持长按显示菜单 | 低 | 产品 | 开放 |

## 参考资料

- [Material Design - Bottom Navigation](https://m3.material.io/components/navigation-bar/overview)
- [iOS Human Interface Guidelines - Tab Bars](https://developer.apple.com/design/human-interface-guidelines/tab-bars)
- 现有文档：
  - `docs/design/ui-design.md` - UI 设计规范
  - `docs/requirements/012-user-system-requirements.md` - 用户体系需求
  - `docs/requirements/001-mobile-ui-requirements.md` - 移动端 UI 需求

---

## 变更记录

| 版本 | 日期 | 作者 | 描述 |
|------|------|------|------|
| 1.0 | 2026-01-26 | Claude Code | 初始版本 |
