# 025-社区分享与浏览需求文档

## 元数据

| 字段 | 值 |
|------|-----|
| 文档编号 | 025-community-share |
| 标题 | 社区分享与浏览需求文档 |
| 版本 | 1.0 |
| 状态 | 草稿 |
| 创建日期 | 2026-02-19 |
| 更新日期 | 2026-02-19 |
| 作者 | Claude Code |

## 概述

### 目的
为 Smart Ingredients 增加社区能力，用户可将配料表分析结果分享至社区供他人浏览点击；支持匿名发布与删除，提升传播与讨论前置基础。

### 范围
**包含**：
- 底部导航新增“社区”Tab（顺序：首页 / 历史 / 社区 / 我的）
- 结果页与历史详情页的“分享到社区”入口
- 社区列表与详情页（公开浏览）
- 匿名发布、分享标记与删除
- 结果卡片的混合渲染（结构化数据 + 可选图片缓存）

**不包含**：
- 评论/点赞/收藏/关注
- 热门排序与内容推荐
- 举报/审核/风控系统
- 分享后编辑功能

### 利益相关者
- 普通用户（发布与浏览）
- 产品团队（提升分享与活跃）
- 开发团队（前后端联动）
- 运维团队（存储与数据增长）

## 功能需求

### 需求 1：底部导航新增社区 Tab
- **编号**: FR-001
- **优先级**: 高
- **描述**: 底部导航扩展为 4 个 Tab，顺序为“首页 / 历史 / 社区 / 我的”。
- **验收标准**:
  - [ ] 底部导航显示 4 个 Tab
  - [ ] 社区 Tab 可正常切换
  - [ ] 保持既有规则：分析流程页面隐藏底部导航

### 需求 2：分享入口
- **编号**: FR-002
- **优先级**: 高
- **描述**: 在分析结果页与历史详情页提供“分享到社区”入口。
- **验收标准**:
  - [ ] 分析结果页可发起分享
  - [ ] 历史详情页可发起分享
  - [ ] 分享过程中提供加载提示与失败提示

### 需求 3：分享内容（结果卡片）
- **编号**: FR-003
- **优先级**: 高
- **描述**: 分享内容以结果卡片为核心，包含缩略图、健康评分与一句话摘要，并保留原始配料表文本。
- **验收标准**:
  - [ ] 列表项展示缩略图 + 健康评分 + 摘要文本
  - [ ] 详情页可展示原始配料表文本
  - [ ] 结果卡片在无图片时可由结构化数据渲染

### 需求 4：社区列表（公开浏览）
- **编号**: FR-004
- **优先级**: 高
- **描述**: 社区列表对所有用户开放，默认按发布时间倒序展示。
- **验收标准**:
  - [ ] 未登录可浏览社区列表
  - [ ] 列表默认“最新发布”排序
  - [ ] 支持分页加载
  - [ ] 点击列表项进入详情页

### 需求 5：详情页展示
- **编号**: FR-005
- **优先级**: 中
- **描述**: 详情页展示结果卡片与原始配料表，并显示作者类型。
- **验收标准**:
  - [ ] 若有卡片图片优先显示图片
  - [ ] 无图片时展示结构化渲染卡片
  - [ ] 作者显示“匿名用户”或用户名

### 需求 6：匿名发布与删除
- **编号**: FR-006
- **优先级**: 高
- **描述**: 支持匿名发布，允许发布者删除自己的社区帖。
- **验收标准**:
  - [ ] 匿名发布时生成并本地保存分享 token
  - [ ] 删除请求需携带 token 或登录身份
  - [ ] 删除入口位于历史详情页

### 需求 7：分享状态标记
- **编号**: FR-007
- **优先级**: 中
- **描述**: 已分享的历史记录需标记分享状态并可执行删除。
- **验收标准**:
  - [ ] 已分享记录显示“已分享”状态
  - [ ] 删除后状态同步更新

## 非功能需求

### 性能
- 社区列表首次加载 < 1s（20 条）
- 分享创建请求 < 2s（不含图片上传时间）

### 安全性
- 分享 token 仅保存哈希，不保存明文
- 删除操作需权限校验

### 可靠性
- 分享失败需可重试
- 列表与详情接口返回可用降级信息（无图片也可渲染）

### 可扩展性
- 数据结构支持后续扩展评论/点赞字段

## 用户故事

### 故事 1
- **作为** 普通用户
- **我想要** 分享分析结果到社区
- **以便** 让他人看到并参考

### 故事 2
- **作为** 浏览者
- **我想要** 浏览社区最新分享
- **以便** 了解其他人的配料分析

### 故事 3
- **作为** 分享者
- **我想要** 删除我分享的内容
- **以便** 控制我的公开信息

## 用例

### 用例 1：发布社区分享
- **参与者**: 分享者（匿名或登录）
- **前置条件**: 已完成一次分析
- **主流程**: 结果页/历史详情页点击分享 → 创建帖子 → 显示成功提示
- **后置条件**: 社区列表可见该帖子

### 用例 2：浏览社区列表
- **参与者**: 浏览者
- **前置条件**: 无
- **主流程**: 进入社区 Tab → 浏览列表 → 点击进入详情
- **后置条件**: 详情页显示卡片与配料表

### 用例 3：删除社区分享
- **参与者**: 分享者
- **前置条件**: 该分析已分享
- **主流程**: 历史详情页点击删除 → 权限校验 → 删除成功
- **后置条件**: 社区帖子消失，分享状态更新

## 约束条件

### 技术约束
- 复用现有导出图片逻辑（020-export-share-image）
- 不引入重型前端依赖
- 后端使用现有存储与 SQLx 规范

### 业务约束
- MVP 不做内容审核与互动能力

## 依赖关系

### 内部依赖
- 现有分析结果结构（健康评分、摘要、配料表）
- 底部导航框架（013-tab-navigation-and-onboarding）
- 分享图片导出逻辑（020-export-share-image）

### 外部依赖
- 无

## 成功指标

- 分享创建成功率 > 95%
- 社区列表加载成功率 > 99%
- 平均分享创建时延 < 2s（不含图片上传）

## 待解决问题

| 问题 | 影响 | 负责人 | 状态 |
|------|------|--------|------|
| 摘要文本的来源（使用分析 summary 还是重新生成） | 中 | 待定 | 开放 |
| 图片存储位置与清理策略 | 中 | 待定 | 开放 |
| 内容治理与举报策略 | 中 | 待定 | 开放 |

## 参考资料

- docs/requirements/013-tab-navigation-and-onboarding-requirements.md
- docs/requirements/020-export-share-image-requirements.md

---

## 变更记录

| 版本 | 日期 | 作者 | 描述 |
|------|------|------|------|
| 1.0 | 2026-02-19 | Claude Code | 初始版本 |
