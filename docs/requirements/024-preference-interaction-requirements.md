# 024-人群定位交互与导航修复需求文档

## 元数据

| 字段 | 值 |
|------|-----|
| 文档编号 | 024-preference-interaction |
| 标题 | 人群定位交互与导航修复需求文档 |
| 版本 | 1.0 |
| 状态 | 草稿 |
| 创建日期 | 2026-02-16 |
| 更新日期 | 2026-02-16 |
| 作者 | 小周 |

## 概述

### 目的
修复人群定位相关的交互问题与导航错误，提升首页与个人中心可达性，确保未选择人群也能顺畅使用核心流程。

### 范围
**包含**：
- 人群定位页（Onboarding）步骤说明的视觉紧凑化
- 人群选择改为可跳过，未选择时默认“普通人群”并持久化
- 保存/跳过人群后的导航回首页
- 底部导航对 query 的正确拼接，避免 404
- 未选择人群时可进入首页/个人中心

**不包含**：
- 新增人群类型或规则库扩展
- 后端分析逻辑变更
- 重新设计首页或新增新路由

### 利益相关者
- 新用户：不想被强制选择人群即可体验流程
- 现有用户：避免导航异常与 404
- 产品与运营：降低流失，提高完成率

## 功能需求

### 需求 1：人群选择可跳过且默认普通人群
- **编号**: FR-001
- **优先级**: 高
- **描述**: 用户可以不选择人群直接使用应用。若未选择，系统默认“普通人群”，并写入本地与已登录用户的服务端偏好。
- **验收标准**:
  - [ ] 首次进入首页不再强制跳转人群定位页
  - [ ] 未设置人群时，分析流程默认使用“普通人群”
  - [ ] 默认值会写入本地偏好
  - [ ] 已登录用户默认值会同步到服务端偏好

### 需求 2：人群定位页保存/跳过后回首页
- **编号**: FR-002
- **优先级**: 高
- **描述**: 在人群定位页点击“确认人群并开始”或“先体验，后设置”后，导航到首页，不自动进入拍照。
- **验收标准**:
  - [ ] 保存后跳转到 `/`
  - [ ] 跳过后跳转到 `/`
  - [ ] 不再使用 `/?view=scan` 作为默认跳转目标

### 需求 3：人群定位页步骤区改为横向流程指示器
- **编号**: FR-003
- **优先级**: 中
- **描述**: "选人群 / 拍配料表 / 看识别结果"三个步骤从纵向卡片列表改为横向单行流程指示器（图标 + 文字 + 箭头），大幅降低视觉占比，突出人群选择。
- **验收标准**:
  - [ ] 三个步骤横向排列为一行，用箭头（→）连接
  - [ ] 每个步骤显示图标 + 短标题，去掉副描述文字
  - [ ] 整体高度从约 180px 压缩到约 48px
  - [ ] 仍保持可读性与一致的视觉风格

### 需求 4：底部导航 query 拼接修复
- **编号**: FR-004
- **优先级**: 高
- **描述**: 修复底部导航在拼接 query 时遗漏 `?` 的问题，避免出现 `/view=scan` 404。
- **验收标准**:
  - [ ] 当存在 query 时，记录的路径格式为 `/?key=value`
  - [ ] 从个人中心点击首页不再进入 404

### 需求 5：未选择人群可进入个人中心
- **编号**: FR-005
- **优先级**: 高
- **描述**: 未设置人群的情况下，个人中心与首页均可正常进入。
- **验收标准**:
  - [ ] 未设置人群时可进入个人中心
  - [ ] 点击首页可返回首页且不被强制拦截

## 非功能需求

### 可用性
- 首页与个人中心入口保持可达
- 交互与文案保持清晰一致

### 可靠性
- 导航路径无 404
- 默认人群持久化后流程稳定

## 用户故事

### 故事 1
- **作为** 新用户
- **我想要** 不选择人群也能开始体验
- **以便** 快速了解产品能力

### 故事 2
- **作为** 已登录用户
- **我想要** 偏好默认值自动保存
- **以便** 后续分析不必重复设置

### 故事 3
- **作为** 现有用户
- **我想要** 从个人中心点击首页不会出现 404
- **以便** 顺畅返回首页

## 用例

### 用例 1：未选择人群直接体验
- **参与者**: 未登录用户
- **前置条件**: 无偏好记录
- **主流程**:
  1. 进入首页
  2. 点击“开始分析”进入拍照
  3. 系统使用默认“普通人群”进行分析
- **后置条件**: 默认偏好已写入本地
- **备选流程**: 用户进入个人中心设置人群

### 用例 2：保存人群并返回首页
- **参与者**: 用户
- **前置条件**: 进入人群定位页
- **主流程**:
  1. 选择人群
  2. 点击“确认人群并开始”
  3. 返回首页
- **后置条件**: 偏好保存成功

## 约束条件

### 技术约束
- 前端使用 Leptos + Tauri 现有路由机制
- 不新增新的页面路由

## 依赖关系

### 内部依赖
- `frontend/src/pages/onboarding.rs`
- `frontend/src/pages/capture.rs`
- `frontend/src/components/bottom_nav.rs`
- `frontend/src/styles/app.css`

## 成功指标

- 首页与个人中心访问成功率 100%
- 人群定位页跳转 0 失败
- `/view=scan` 404 不再出现

## 待解决问题

| 问题 | 影响 | 负责人 | 状态 |
|------|------|--------|------|
| 默认人群写入时机是否影响体验 | 中 | 小周 | 已解决 |

## 参考资料

- `docs/requirements/013-tab-navigation-and-onboarding-requirements.md`
- `docs/requirements/011-personalized-analysis-requirements.md`

---

## 变更记录

| 版本 | 日期 | 作者 | 描述 |
|------|------|------|------|
| 1.0 | 2026-02-16 | 小周 | 初始版本 |
