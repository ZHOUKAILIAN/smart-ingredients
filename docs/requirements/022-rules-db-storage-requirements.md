# 规则库 DB 存储需求说明

## 背景与目标
当前规则库通过 `rules.json` 启动加载，更新需要改文件并重启。为满足长期迭代与运营维护，需要将规则库存储迁移到数据库，支持更稳定的演进、审计与扩展。

## 目标范围
- 规则库从 DB 读取为主，确保规则可长期维护与扩展。
- 支持规则启用/禁用与基础审计字段。
- 保持现有规则命中逻辑、可信度计算与前端展示不变。
- 支持初始化导入（从现有 `rules.json` 导入）。

## 非目标
- 不提供复杂后台管理 UI。
- 不在本次迭代中引入多语言规则库。
- 不改变现有 LLM 解释逻辑与评分体系。

## 功能需求
1. **规则存储**
   - 规则项需存储：id、name、aliases、category、risk_level、groups、description、evidence、source。
   - 规则可标记 `enabled`，仅启用规则参与命中。
2. **读取方式**
   - 服务启动时加载规则至内存。
   - 支持定时刷新，保证长时间运行可同步规则更新。
3. **初始化导入**
   - 支持从 `rules.json` 一次性导入 DB（脚本或 CLI）。
4. **稳定性**
   - 规则加载失败时保持可用：返回空命中并给出可信度降级提示。

## 质量与性能
- 规则加载与刷新需在后台执行，不阻塞请求。
- 规则命中逻辑不低于当前性能；查询阶段不频繁访问 DB。

## 验证标准
- 启动后可从 DB 成功加载规则；刷新后规则命中能体现新规则。
- 执行端到端流程（上传→OCR→确认→LLM）返回规则命中与可信度。
- 前端 `cargo check` 通过（允许现有 warning）。
