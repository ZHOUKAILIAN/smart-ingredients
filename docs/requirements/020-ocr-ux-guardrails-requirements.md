# 020-需求文档

## 元数据

| 字段 | 值 |
|------|-----|
| 文档编号 | 020-ocr-ux-guardrails |
| 标题 | OCR 质量提升与强提醒补充 需求文档 |
| 版本 | 1.0 |
| 状态 | 草稿 |
| 创建日期 | 2026-02-13 |
| 更新日期 | 2026-02-13 |
| 作者 | 小周 |

## 概述

### 目的
在 019 规则兜底与可信度基础上，补强 OCR 质量与强提醒体验，降低误识别带来的风险，并让高风险提示更明确、更可信。

### 范围
- 提升 OCR 稳定性与中文识别准确率
- 对高风险场景（过敏原/儿童/孕妇）提供强提醒与明确文案
- 强化可信度与规则命中的解释性展示

### 利益相关者
- 终端用户
- 产品/运营
- 研发/测试

## 功能需求

### 需求 1：OCR 预处理与重试
- **编号**: FR-001
- **优先级**: 高
- **描述**: OCR 前增加图像预处理（灰度/二值化/放大），并在识别为空或极短时自动重试（可切换参数）。
- **验收标准**:
  - [ ] 低清晰度中文配料图可稳定输出可读文本
  - [ ] OCR 返回空或过短文本时自动重试并有可追溯记录

### 需求 2：强提醒与规则兜底补强
- **编号**: FR-002
- **优先级**: 高
- **描述**: 对过敏原/儿童/孕妇敏感成分提供醒目提示与统一文案，确保规则命中后优先展示。
- **验收标准**:
  - [ ] 命中过敏原时显示强提醒区块
  - [ ] 规则命中理由与适用人群清晰可读

### 需求 3：可信度与解释性增强
- **编号**: FR-003
- **优先级**: 中
- **描述**: 将可信度来源展示为可读理由（规则命中/文本长度/置信度等），并与 LLM 结论保持一致性。
- **验收标准**:
  - [ ] 可信度条目可解释且与规则命中对应
  - [ ] 规则结论与 LLM 输出不冲突

## 非功能需求

### 性能
- OCR 端整体处理时间不超过 8s（冷启动模型下载除外）

### 可靠性
- OCR 失败返回明确错误与可重试提示

### 可扩展性
- 预处理参数与重试次数可配置

## 用户故事

### 故事 1
- **作为** 有过敏史的用户
- **我想要** 明确的过敏原强提醒
- **以便** 快速判断是否可食用

### 故事 2
- **作为** 普通用户
- **我想要** 可信度与规则命中解释
- **以便** 判断结论是否可靠

## 用例

### 用例 1：OCR 失败重试
- **参与者**: 用户
- **前置条件**: 上传图片
- **主流程**: OCR 识别 → 空/过短 → 自动重试 → 输出文本
- **后置条件**: 返回文本或明确失败
- **备选流程**: 重试失败 → 引导用户手动修正

## 约束条件

### 技术约束
- 仍保持现有 OCR 服务（PaddleOCR）

## 依赖关系

### 内部依赖
- 规则库与可信度模块

### 外部依赖
- OCR 模型下载

## 成功指标

- OCR 可用率提升
- 过敏原强提醒命中后用户可见

## 待解决问题

| 问题 | 影响 | 负责人 | 状态 |
|------|------|--------|------|
| 是否新增更完整的过敏原/人群规则 | 中 | 小周 | 开放 |

## 参考资料

- 019-规则兜底需求文档

---

## 变更记录

| 版本 | 日期 | 作者 | 描述 |
|------|------|------|------|
| 1.0 | 2026-02-13 | 小周 | 初始版本 |
